# UI - Пользовательский интерфейс

## Назначение
Содержит компоненты пользовательского интерфейса для отображения игровой информации. Все UI компоненты подписываются на события от игровых систем и обновляются автоматически.

## Основные компоненты

### IUIElement
- **Назначение**: Интерфейс для UI элементов, которые могут быть автоматически настроены
- **Ответственность**:
  - Унификация API для настройки UI компонентов
  - Замена рефлексии на типобезопасные методы
  - Обеспечение консистентности в настройке UI
- **Методы**:
  - `SetupUI(Image image)` - настройка Image компонента

### HealthBar
- **Назначение**: Отображение полоски здоровья игрока
- **Ответственность**:
  - Подписка на событие `OnHealthChanged` от `PlayerHealth`
  - Визуализация текущего уровня здоровья через `Image.fillAmount`
  - Плавное изменение заполнения и цвета
  - Динамический цвет в зависимости от процента здоровья (зеленый → желтый → красный)
- **Настройки**:
  - `healthyColor` - цвет при полном здоровье (по умолчанию зеленый)
  - `midHealthColor` - цвет при среднем здоровье (по умолчанию желтый)
  - `lowHealthColor` - цвет при низком здоровье (по умолчанию красный)
  - `smoothTransition` - плавное изменение заполнения
  - `transitionSpeed` - скорость анимации

### ArmorBar
- **Назначение**: Отображение полоски брони игрока
- **Ответственность**:
  - Подписка на событие `OnArmorChanged` от `PlayerHealth`
  - Визуализация текущего уровня брони через `Image.fillAmount`
  - Автоматическое скрытие когда броня = 0
  - Плавное появление/исчезновение через `CanvasGroup.alpha`
  - Динамический цвет в зависимости от процента брони
- **Настройки**:
  - `armorColor` - цвет при хорошей броне (по умолчанию синий)
  - `lowArmorColor` - цвет при низкой броне (по умолчанию серый)
  - `hideWhenEmpty` - скрывать ли бар когда броня = 0
  - `smoothTransition` - плавное изменение заполнения
  - `fadeSpeed` - скорость появления/исчезновения

## Принципы работы

1. **Инициализация**:
   - Все UI компоненты получают ссылку на `PlayerHealth` через `CoreReferences`
   - Автоматическая подписка на события в `Start()`
   - Автоматическая отписка в `OnDestroy()` для предотвращения утечек памяти
   - **UIInitializer** автоматически настраивает компоненты через публичные методы (без рефлексии)

2. **Обновление**:
   - UI компоненты реагируют только на события, не делают `Update()` запросы к PlayerHealth
   - Плавная анимация изменений через `Mathf.Lerp` в `Update()`
   - Автоматическое изменение цвета в зависимости от значения

3. **Визуальные особенности**:
   - **HealthBar**: меняет цвет от зеленого через желтый к красному
   - **ArmorBar**: плавно исчезает когда броня заканчивается
   - Оба бара поддерживают плавную анимацию изменений

4. **Архитектура**:
   - Все UI элементы реализуют интерфейс `IUIElement`
   - Публичные методы `SetupUI()` и `SetupLayout()` для настройки
   - Отсутствие рефлексии для лучшей производительности и безопасности типов

## Зависимости
- **Исходящие**: Player (PlayerHealth)
- **Входящие**: Core (CoreReferences)
- **Unity компоненты**: UnityEngine.UI (Image, CanvasGroup)

## Интеграция в сцену

### Пример структуры Canvas:
```
Canvas
├── HealthBar
│   └── Fill (Image с типом Filled)
└── ArmorBar
    └── Fill (Image с типом Filled)
```

### Настройка компонентов:

1. **HealthBar**:
   - Добавить компонент `HealthBar` на GameObject с `Image`
   - UIInitializer автоматически настроит `Image Type` = `Filled` и `Fill Method` = `Horizontal`
   - Поле `fillImage` устанавливается автоматически через `SetupUI()`
   - **Позицию и размер настраивайте вручную в Unity Editor через RectTransform**

2. **ArmorBar**:
   - Добавить компонент `ArmorBar` на GameObject с `Image`
   - UIInitializer автоматически настроит `Image Type` = `Filled` и `Fill Method` = `Horizontal`
   - Поле `fillImage` и `canvasGroup` устанавливаются автоматически через `SetupUI()`
   - Компонент `CanvasGroup` добавится автоматически если отсутствует
   - **Позицию и размер настраивайте вручную в Unity Editor через RectTransform**

3. **Настройка позиции и размера в Unity Editor**:
   - Выберите GameObject с HealthBar/ArmorBar
   - В компоненте **RectTransform** настройте:
     - **Position**: позицию элемента
     - **Size**: размер элемента  
     - **Anchor**: привязку к краям экрана
     - **Pivot**: точку поворота/масштабирования

4. **Ручная настройка** (альтернатива UIInitializer):
   ```csharp
   // Для HealthBar
   healthBar.SetupUI(healthImage);
   
   // Для ArmorBar  
   armorBar.SetupUI(armorImage);
   ```

## Примечания
- Все UI компоненты не требуют ручной привязки к игроку - они используют `CoreReferences`
- Компоненты безопасны к уничтожению игрока и автоматически отписываются от событий
- Цвета и пороги полностью настраиваются в инспекторе Unity
- Плавность анимаций можно отключить для ретро-стиля (instant updates)
- **Новая архитектура**: Отсутствие рефлексии, использование публичных методов и интерфейсов
- **Производительность**: Прямые вызовы методов вместо медленной рефлексии
- **Безопасность типов**: Ошибки настройки обнаруживаются на этапе компиляции

