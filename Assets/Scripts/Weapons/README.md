# Weapons - Система оружия

## Назначение
Реализует систему оружия для FPS механик проекта 64.WAD. Включает базовую архитектуру оружия, конкретные реализации (пистолет) и менеджер управления оружием.

## Основные компоненты

### Weapon (базовый класс)
- **Назначение**: Абстрактный базовый класс для всех видов оружия
- **Ответственность**:
  - Управление боеприпасами (текущие/максимальные)
  - Логика перезарядки с таймером прогресса
  - Система разброса (одинаковая во всех состояниях)
  - Аудио эффекты (выстрел, перезарядка, пустая обойма)
  - События стрельбы и перезарядки
- **Использование**: Наследуется конкретными типами оружия

### Pistol
- **Назначение**: Точное оружие средней дальности с hitscan стрельбой
- **Характеристики**:
  - Урон: 25 единиц
  - Дальность: 50 метров
  - Скорострельность: 3 выстрела/сек
  - Боекомплект: 12 патронов
  - Разброс: 0.01 радиан (минимальный)
- **Особенности**:
  - Мгновенное попадание через Raycast
  - Красные маркеры попадания (сферы)
  - Интерфейс IDamageable для нанесения урона

### Shotgun
- **Назначение**: Мощное оружие ближнего боя с широким разбросом
- **Характеристики**:
  - Урон: 12 единиц за дробь (до 96 общего урона)
  - Дальность: 25 метров (меньше пистолета)
  - Скорострельность: 0.8 выстрела/сек (медленнее пистолета)
  - Боекомплект: 6 патронов
  - Дроби: 8 рейкастов за выстрел
  - Разброс: 0.15 радиан (большой)
- **Особенности**:
  - Множественные hitscan попадания за выстрел
  - Синие маркеры попадания (сферы)
  - Эффективен на близкой дистанции

### WeaponManager
- **Назначение**: Управляет оружием игрока и обрабатывает ввод
- **Ответственность**:
  - Переключение между доступными видами оружия
  - Обработка команд стрельбы и перезарядки
  - Интеграция с InputHandler для команд ЛКМ и R
  - Автоматическая смена оружия при исчерпании боеприпасов (опционально)
- **Использование**: Добавляется как child объект к PlayerController

## Принципы работы

### Система стрельбы
1. **Hitscan**: Мгновенные попадания через Physics.Raycast
2. **Разброс**: Постоянный для всех состояний (бег, прыжок, ходьба)
3. **Урон**: Применяется через интерфейс IDamageable
4. **Эффекты**: Звуки, частицы, camera shake (планируется)

### Управление боеприпасами
1. **Расход**: Уменьшение при каждом выстреле
2. **Перезарядка**: Автоматическая по R или при попытке стрельбы с пустой обоймой
3. **Таймер**: Прогресс перезарядки отображается в UI (0-100%)
4. **События**: Уведомления UI о изменении боеприпасов

### Интеграция с вводом
- **ЛКМ (Attack)**: Стрельба с проверкой возможности выстрела
- **R (Reload)**: Принудительная перезарядка
- **1/2/3 (Numbers)**: Прямое переключение на оружие по номеру
- **Колесико мыши**: Циклическое переключение оружий (вверх/вниз)
- **События**: Обработка через InputHandler с буферизацией

## Зависимости
- **Исходящие**: Player (InputHandler, PlayerCamera), Core (CoreReferences)
- **Входящие**: UI (для отображения боеприпасов), Testing (TestingHelper)

## Расширение системы

### Добавление нового оружия
1. Наследоваться от класса `Weapon`
2. Переопределить метод `PerformShot(Vector3 direction)`
3. Настроить характеристики в `Awake()`
4. Добавить в массив `availableWeapons` в WeaponManager

### Поддерживаемые эффекты
- ParticleSystem для дульной вспышки
- AudioSource для звуковых эффектов
- Debug визуализация траектории (Gizmos)
- Интеграция с camera shake

## Debug возможности
- **TestingHelper**: Отображение информации об оружии в реальном времени
  - Информация о текущем оружии (урон, дальность, патроны)
  - Статистика последнего выстрела (попадания/промахи)
  - Для дробовика: количество попавших дробей и процент попаданий
- **F5**: Принудительная перезарядка для тестирования
- **F6**: Тестовый выстрел
- **3D маркеры**: Физические сферы в местах попадания (1 сек)
  - Красные для пистолета, синие для дробовика
- **Консоль**: Подробное логирование выстрелов и переключений

## Примечания
- Система спроектирована под 2D спрайты в UI (как в DOOM)
- Отдача отсутствует намеренно - только разброс
- Поддержка множественных видов оружия заложена в архитектуру
- События позволяют легко интегрировать с UI и системами прогресса
